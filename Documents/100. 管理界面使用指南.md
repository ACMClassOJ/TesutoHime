# 管理界面使用指南

by cong258258 ，更新于 2022.9.13

## 题面管理

- 新增一道题的题面：直接点击右侧“获取最新空题号”，分别填写题目标题、发布时间（默认为当前时刻）、题目类型、题目描述、输入输出格式、输入输出样例与数据范围，点击“添加问题”。添加成功后题号右侧状态变为已存在，此时可以进行题面修改。

- 修改一道题的题面：输入希望修改的题目的题号，点击右侧“查看题目状态”。系统将显示已经存在于数据库中的信息，可以在此基础上进行修改。修改完毕请点击“修改问题”。

- 删除一道题的题面：输入希望删除的题目的题号，点击右侧“查看题目状态”，点击“删除问题”。

  - **由于文本框 markdown 预览特性存在已知的技术问题，强烈建议在多次题目操作之间刷新一下管理界面。**
  - 题面文本格式请严格遵守 ``题面格式规范.md``。
  - **所有题面相关数据都存储在数据库中，因此管理界面的题面选项卡的任何新增、修改、删除行为都不会影响数据包中的 ``description.md``。**详情参照数据格式规范中 ``description.md`` 节。
  - 除标题、时间、类型外，剩余文本框均可留空，题目详情界面将不显示这一块内容。
  - 除标题、时间、类型外，剩余文本框均使用 markdown 格式渲染，因此请**特别留意输入题面内容与显示情况的不同**（如在 markdown 中前置 tab 将被渲染为代码块，需要一个多余的回车表示换行等）。支持内嵌 **$\LaTeX$​​​单行公式**（多行公式渲染存在已知的问题，请尽可能避免）。同时，若需要定义高级样式，还可以在题面中直接嵌入 html 代码与内联 CSS，甚至简单的 JS 脚本。
  - 除标题、时间、类型外的剩余文本框中，若使用 markdown 中 ``` 的语法将文本块包裹起来，访问题面时网页前端将自动识别此代码块并生成一个复制按钮以便进行复制。因此，强烈建议将**样例输入与样例输出数据、题目描述中的框架代码等**包裹起来，以便学生直接复制。
  - 若需要插入图片，建议上传到 ACM OJ 图床服务，建议使用``<img>``标签插入题面以更好的控制题目格式。
  - 时空限制在上传数据时自动生成，不必在题面中手动注明。详见**评测数据管理**。

## 比赛与作业管理

- 在 ACM Class OnlineJudge 中，比赛、作业和考试是同一个东西，仅渲染方式不同。
  - 比赛：记部分分，记罚时，排名。
  - 作业：只记录通过的题目数量，不排名。
  - 考试：一种更加严格的，适用于机考的比赛，包括比赛的所有特性。除此以外：1. 同一时刻非管理员用户只能报名同一场考试，在考试结束前暂时无法加入新的作业、比赛或考试。2. 考试时非管理员用户只能查看自己在考试题目上的提交，因此无法查看别人在考试题目上的提交（哪怕提交时设置为公开），也无法查看自己不在考试列表里题目的提交。
- 新建一场比赛：直接点击右侧“获取最新空比赛 ID”，分别填写名称、起始时间（默认为当前时刻）、结束时间（请避免结束时间早于起始时间），选择类型是比赛还是作业。
- 修改一场比赛：输入希望修改的比赛的 ID，点击右侧“查看比赛情况”。系统将显示已经存在于数据库中的信息，可以在此基础上进行修改。修改完毕请点击“修改比赛”。
- 删除一场比赛：输入希望删除的比赛的 ID，点击右侧“查看比赛情况”，点击“删除比赛”。
- 修改比赛题号：输入希望修改的比赛的 ID，点击右侧“查看比赛情况”，再点击“修改比赛题号列表”。
  - 要添加或删除题号，请在框中输入题号（回车分割），点击“添加”或“删除”。
  - **如果添加题号时重复了，删除时将会把多个重复题号一起删除。**
- 修改参赛学生列表：输入希望修改的比赛的 ID，点击右侧”查看比赛情况“，再点击“修改参赛学生列表”。
  - 要添加或删除学生，请在框中输入学生的**用户名**（回车分割），点击“添加”或“删除”。
  - **如果添加学生时重复了，删除时将会把多个重复参赛的标记一起删除。**

## 评测数据管理

- ACM Class OnlineJudge 支持多种教学特化的强大评测方式 。功能包括但不限于：编译时长限制；运行时间、内存、磁盘使用限制与统计；Valgrind 内存泄漏检测；git 仓库编译评测；Verilog 评测；hpp 头文件评测；各种自定义 SPJ。

- 简单概括而言，如果你需要评测的是简单的 OI 题（包括若干个输入文件，若干个标答输出文件，不使用 SPJ，通过 stdout 与输出文件进行全文对比），那么你可以使用数据（GUI）选项卡来进行上传；否则，**我们强烈推荐你使用自由度更高的数据（ZIP）上传方式**。

- 数据上传（GUI）：填写题号，编译时长，SPJ 类型等内容，填写评测组配置与数据点配置后，点击打包上传所有数据。

  - 请确认题号已存在，即题面已上传后再上传数据。

  - 编译时长单位毫秒，建议值为10000，如需从 git 拉取编译评测可适当增加。

  - SPJ 类型一般为 classic。

  - 题面：建议文件名为``description.md/doc/docx/txt``。此文件仅仅是为了数据包的完整性给以后的助教和管理员提供便利，其本身与数据库和网页题面显示并没有关联。若存在难以给出题面情况（比如大作业的题面在 github 上），这一项可省略。

  - 测试数据：

    - 在此选择输入输出文件，可多选。
    - 输入文件命名规范：若干``数字.in``，**文件名请采用连续编号的，从 1 开始的纯数字**，与``.out/ans``对应。
    - 输出文件命名规范：若干``数字.out``或``数字.ans``，**文件名请采用连续编号的，从 1 开始的纯数字**，与``.in``对应。同时存在``.out``和``.ans``时后者优先级高。
    - 注意：我们的 OJ 评测均采用 Linux 环境，默认 diff 时有行末空格过滤。虽然对于许多题目，换行符为 Windows 的``CRLF(\r\n)``还是 Linux 的``LF(\n)``并不会产生很大的影响，但请各位出数据的助教尽可能不要出现``CRLF``。

  - std：在数据包中放标程仅仅是为了数据包的完整性给以后的助教和管理员提供便利，其本身与评测并没有关联。建议命名为``solution.cpp/hpp``。可省略。

    - 对于所有评测 cpp 类题目，避免将标答命名为``main.cpp``。
    - 对于评测头文件类题目，避免将标答命名为``src.h``、``src.hpp``。

  - SPJ 与 Scorer：省略。

  - **评测组配置与数据点配置（简易）：一般无脑点击“add row”若干次即可，使得评测组条目、数据点条目均与上传的测试数据数量一致即可。**

  - 评测组配置（高级）：记分策略。以下图为例，本题共有五个测试组，每组 20 分共 100 分。以组 1 为例，三个测试点 1, 2, 3 均通过才能获得该组的 20 分，以此类推。（本条仅为不使用 SPJ 的情况，若要使用 SPJ 请不要使用 GUI 上传数据）

    <img src="https://acm.sjtu.edu.cn/OnlineJudge-pic/20220211-190811-251466.jpg">

  - 数据点配置（高级）：编译评测策略。以下图为例，本题共有 11 个测试点，每个测试点限时 1 秒，内存限制约 256 MB。

    - 内存限制相关：Python 脚本与沙箱启动有一定量的内存 overhead，**因此请不要将内存占用设定为低于 20 MB！**
    - Valgrind 相关：其中，测试点 9, 10 开启了 Valgrind 内存泄漏测试（测试参数参考主页），只有经检测没有内存泄漏才算通过测试点。
    - Dependency 相关：其中，如果测试点 1 没有通过，那么测试点 2 不会被评测，评测详情显示``Skipped``；连带的，测试点 3 也不会被评测。
    - **对于开启 Valgrind 的测试点，测试结果中 Memory Leak 的优先级高于 Wrong Answer。**因此如果你希望先测一遍正确性，再测一遍内存泄漏，那么建议你配置如下图的 7, 8, 9, 10 ，上传测试数据时，``7.in/out/ans``与``9.in/out/ans``完全相同，``8.in/out/ans``与``10.in/out/ans``完全相同，只有 AC 了 7, 8 才会测试 9, 10 。将上述评测组配置的例子与数据点配置结合起来看，那么评测组 3 就是正确性测试组，评测组 4 就是内存泄漏测试组。
    - 将上述评测组配置的例子与数据点配置结合起来看，情形如下：如果某用户测试点 1 没有通过，那么测试点 2, 3 不会被评测，评测组 1 没有得分；如果某用户测试点 4 没有通过，测试点 5, 6 仍然会被评测，然而无论 5, 6 通过与否，测试组 2 都不会得分。

    <img src="https://acm.sjtu.edu.cn/OnlineJudge-pic/20220211-194231-201862.jpg">

- 数据（ZIP）：

  - 上传数据压缩包：选择一个符合要求的``.zip``，点击上传即可。**压缩包格式请认真阅读 ``数据格式规范.md``。**
  - **由于 ACM 班服务器的网络故障，使用 ipv6 进行大量数据上传可能非常慢甚至无响应，请暂时使用 ipv4。**
  - 下载数据压缩包：输入题号，点击下载即可。此功能在题目详情页面对管理员也可见。

- 无论使用 GUI 还是 ZIP 上传的数据，管理界面都会自动提取您配置的数据点信息（从您填写的表格或从 ZIP 中的 ``config.json``），将其更新在题面的**时空磁盘限制（运行时）**一栏中。

- 使用 ZIP 上传数据时，您可能会遇到“压缩包不符合规范”的警告弹窗，这是因为我们采用的前端 jszip 插件无法解压您的压缩包。您可以检查您的压缩包格式是否正确（例：``1000.zip/config.json``），并尝试使用别的压缩软件重新压缩。您可以用 jszip 的官方链接来测试压缩包合规性。如果您确信自己压缩包的格式是对的，那么忽略此警告后**可能**依然可以正常评测，但题面里**时空磁盘限制（运行时）**一栏的信息就无法显示了。


## 评测管理

- 批量重测：填入评测状态界面的评测编号（而非题目编号），使用回车分隔。
- 批量题目重测：填入题目编号，使用回车分隔。由于要重测数据库里这一题所有提交的代码，会非常耗时，请务必谨慎使用此项。
- 批量取消评测：填入评测状态界面的评测编号（而非题目编号），使用回车分隔。此功能将指定的评测记录内容设置为 System Error 并判零分。请注意，对于一条已在 Running and Judging 状态的评测任务，设置为 System Error 状态后， 评测机仍有可能返回评测结果，此时 System Error 状态将被真实的评测记录覆盖。 因此，建议在如下情况使用此功能：需要作废一条已经出了结果的评测记录；因评测列表积压等待的评测任务过多，需要手动取消一部分 Pending 任务；因评测机故障需要取消一条极长时间卡 Running 的评测任务（请管理员留意是否还需要清空 busy_flag）。
- 批量题目取消评测：填入题目编号，使用回车分隔。找出所有此题的提交并应用上一条“批量取消评测”的效果。
- 添加一条评测：给指定用户塞一条评测。支持指定评测机评测。

## 图床

- 支持 gif，jpg，png，svg 格式图片上传，大小上限为 10MB 。
- 选择文件上传后，可以预览上传图片是否符合预期，并点击按钮复制图片链接或图片 html 源码。
- 上传同一文件名的图片不会将之前上传过的图片覆盖，因为每次上传都会生成随机的新文件名。

## 实名管理

- 左右一一对应，均以回车分割。

- 实名建议格式为年份-课程-名字，如 22-IEEE算法-张三。

- 如果同一学号出现了多条实名信息，系统将以最后一条导入的为准。

## 联系 ACM OJ 开发组

- [acmclassoj@googlegroups.com](mailto:acmclassoj@googlegroups.com)