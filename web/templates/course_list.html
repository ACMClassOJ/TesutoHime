{% extends 'base.html' %}

{% set page=title %}

{% block content %}
<div class="card card-body">
    <h1>{{ title }}</h1>
    {%- if description != '' -%}
    <div>{{ render(description) }}</div>
    {%- endif -%}
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
                <th>编号</th>
                <th>班级名称</th>
                {%- if show_tag -%}
                <th>标签</th>
                {%- endif -%}
                {%- if show_term -%}
                <th>学期</th>
                {%- endif -%}
                <th>加入</th>
            </tr>
            </thead>
            {% for course in courses -%}
                <tr>
                    <td>{{ course.id }}</td>
                    <td><a href="/OnlineJudge/course/{{ course.id }}">{{ course.name }}</a></td>
                    {%- if show_tag -%}
                    <td>
                        {%- if course.tag_id != None -%}
                        <a href="/OnlineJudge/course/tag/{{ course.tag.id }}">{{ course.tag.name }}</a>
                        {%- endif -%}
                    </td>
                    {%- endif -%}
                    {%- if show_term -%}
                    <td>
                        {%- if course.term_id != None -%}
                        <a href="/OnlineJudge/course/term/{{ course.term.id }}">{{ course.term.name }}</a>
                        {%- endif -%}
                    </td>
                    {%- endif -%}
                    <td>
                        {%- set enrollment = get_enrollment(g.user, course) -%}
                        {%- if enrollment != None -%}
                        {%- if enrollment.realname_reference != None -%}
                        <button disabled class="btn btn-primary btn-sm">已加入</button>
                        {%- elif can_join(course) -%}
                        <form action="/OnlineJudge/course/{{ course.id }}/quit" method="POST">
                            {{ g.csrf() }}
                            <input type="hidden" name="id" value="{{ enrollment.id }}">
                            <button type="submit" class="btn btn-outline-primary btn-sm">退出</button>
                        </form>
                        {%- endif -%}
                        {%- elif can_join(course) -%}
                        <form action="/OnlineJudge/course/{{ course.id }}/join" method="POST">
                            {{ g.csrf() }}
                            <button type="submit" class="btn btn-primary btn-sm">加入</button>
                        </form>
                        {%- endif -%}
                    </td>
                </tr>
            {%- endfor %}
        </table>
    </div>
    {{ page_switcher(pages, args) }}
</div>
{% endblock %}
